<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário para Firebase</title>
</head>
<body>
    <form id="firebaseForm">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="nome"><br>

        <label for="linha">Linha:</label>
        <select id="linha" name="linha">
            <option value="Linha05">Linha05</option>
            <option value="Linha06">Linha06</option>
        </select><br>

        <label for="tr">TR:</label>
        <select id="tr" name="tr">
            <!-- Opções serão adicionadas dinamicamente -->
        </select><br>

        <label for="st">ST:</label>
        <select id="st" name="st">
            <!-- Opções serão adicionadas dinamicamente -->
        </select><br>

        <label for="nivelGraxa">Nível de Graxa:</label>
        <input type="number" id="nivelGraxa" name="nivelGraxa"><br>

        <label for="status">Status:</label>
        <select id="status" name="status">
            <option value="Operando">Operando</option>
            <option value="Nao operando">Não operando</option>
        </select><br>

        <label for="observacao">Observação:</label>
        <textarea id="observacao" name="observacao"></textarea><br>

        <label for="dataRealizada">Data Realizada:</label>
        <input type="date" id="dataRealizada" name="dataRealizada"><br>

        <button type="submit">Enviar</button>
    </form>

    <!-- Adicione a biblioteca do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-database.js"></script>

    <script>
        // Sua configuração do Firebase
        const firebaseConfig = {
             apiKey: "AIzaSyDV-fD0ZdVHYVVfNyzFigdwYYc1M4yPOGU",
  authDomain: "lub-porto.firebaseapp.com",
  databaseURL: "https://lub-porto-default-rtdb.firebaseio.com",
  projectId: "lub-porto",
  storageBucket: "lub-porto.firebasestorage.app",
  messagingSenderId: "360523245715",
  appId: "1:360523245715:web:0a41e8977ea91e32a78566",
  measurementId: "G-5W7R92NLD4"
        };

        // Inicialize o Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Função para preencher os campos de seleção com os dados do Firebase
        function preencherSelecoes() {
            const linhaSelect = document.getElementById('linha');
            const trSelect = document.getElementById('tr');
            const stSelect = document.getElementById('st');

            // Ler dados das linhas disponíveis
            linhaSelect.addEventListener('change', function() {
                const linhaValue = linhaSelect.value;
                trSelect.innerHTML = '';
                database.ref(`${linhaValue}`).once('value', function(snapshot) {
                    snapshot.forEach(function(childSnapshot) {
                        const trKey = childSnapshot.key;
                        const option = document.createElement('option');
                        option.value = trKey;
                        option.text = trKey;
                        trSelect.appendChild(option);
                    });

                    // Ler dados dos ST quando um TR é selecionado
                    trSelect.addEventListener('change', function() {
                        const trValue = trSelect.value;
                        stSelect.innerHTML = '';
                        database.ref(`${linhaValue}/${trValue}`).once('value', function(snapshot) {
                            snapshot.forEach(function(childSnapshot) {
                                const stKey = childSnapshot.key;
                                const option = document.createElement('option');
                                option.value = stKey;
                                option.text = stKey;
                                stSelect.appendChild(option);
                            });
                        });
                    });

                    // Disparar evento de alteração no TR ao carregar a página
                    if (trSelect.options.length > 0) {
                        trSelect.dispatchEvent(new Event('change'));
                    }
                });
            });

            // Disparar a leitura dos dados ao carregar a página
            linhaSelect.dispatchEvent(new Event('change'));
        }

        // Chamar a função para preencher os campos de seleção
        preencherSelecoes();

        // Função para enviar dados ao Firebase
        document.getElementById('firebaseForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const nome = document.getElementById('nome').value;
            const linha = document.getElementById('linha').value;
            const tr = document.getElementById('tr').value;
            const st = document.getElementById('st').value;
            const nivelGraxa = document.getElementById('nivelGraxa').value;
            const status = document.getElementById('status').value;
            const observacao = document.getElementById('observacao').value;
            const dataRealizada = document.getElementById('dataRealizada').value;

            database.ref(`${linha}/${tr}/${st}`).set({
                nome: nome,
                data: dataRealizada,
                nivelGraxa: nivelGraxa,
                observacao: observacao,
                operacao: status
            });

            alert('Dados enviados com sucesso!');
        });
    </script>
</body>
</html>
